<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>TV Shows</title>
  <meta name="description" content="The HTML5 Herald">
  <meta name="author" content="SitePoint">

  <script language="JavaScript" type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

  <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
  <![endif]-->
</head>

<body>
  <header>

  </header>

  <main style="height: 100vh">
    <table id="gameTable" style="height:100%" class="table table-striped table-dark">
      <tbody>
        <tr>
          <td class="align-middle" id = "i1j1">_</td>
          <td class="align-middle" id = "i1j2">_</td>
          <td class="align-middle" id = "i1j3">_</td>
        </tr>
        <tr>
          <td class="align-middle" id = "i2j1">_</td>
          <td class="align-middle" id = "i2j2">_</td>
          <td class="align-middle" id = "i2j3">_</td>
        </tr>
        <tr>
          <td class="align-middle" id = "i3j1">_</td>
          <td class="align-middle" id = "i3j2">_</td>
          <td class="align-middle" id = "i3j3">_</td>
        </tr>
      </tbody>
      </table>
  </main>

<br />

</body>

<style>
  td
  {
      font-size: 130px;
      text-align: center;
  }
</style>

<script>
function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}


class Game {

  constructor(table) {
    this.table = table;
    this.nrMoves = 0
    this.validIndexes = [0, 1, 2, 3, 4, 5, 6, 7, 8]
    this.finished = false
    this.refreshTable()
  }

  refreshTable() {
    for(var i = 0; i < 3; i++) {
        for(var j = 0; j < 3; j++)
          this.table.rows[i].cells[j].innerHTML = "_";
        }
  }


  checkWhoWon() {
      if(this.validIndexes.length == 0) {
         this.finished = true;
      }

      if(this.checkIfWon("X")) {
        alert("You WON");
        this.finished = true;
      }
      else {
        if(this.finished == true) {
          alert("TIE")
        }

        if(this.checkIfWon("O")) {
          alert("You LOST");
          this.finished = true;
        }
      }

  }

  checkIfWon(chr) {
    var chrWon = false;
    if(this.table.rows[0].cells[0].innerHTML == chr && this.table.rows[1].cells[1].innerHTML == chr && this.table.rows[2].cells[2].innerHTML == chr)
       chrWon = true;

    if(this.table.rows[2].cells[0].innerHTML == chr && this.table.rows[1].cells[1].innerHTML == chr && this.table.rows[0].cells[2].innerHTML == chr)
       chrWon = true;

    for(var i = 0; i < 3; i ++) {
      var justX = true;
      for(var j = 0; j < 3; j++)
        if(this.table.rows[i].cells[j].innerHTML != chr)
          justX = false;

      if(justX)
        chrWon = true;
    }

    for(var j = 0; j < 3; j ++) {
      var justX = true;
      for(var i = 0; i < 3; i++)
        if(this.table.rows[i].cells[j].innerHTML != chr)
          justX = false;

      if(justX)
        chrWon = true;
    }

    return chrWon;
  }

  movePlayer(i, j) {
     if(this.finished)
       return;

      // Check if move valid
      if(this.table.rows[i].cells[j].innerHTML === "_") {
        // Make the move
        this.table.rows[i].cells[j].innerHTML = "X"

        // Mark that position as inaccessible
        this.validIndexes.splice( this.validIndexes.indexOf( i * 3 + j ), 1 )
      }

      // Give the turn to the computer
      this.checkWhoWon();
      this.moveComputer();
  }

  moveComputer() {
      if(this.finished)
        return;

      var randomIndex = Math.floor((Math.random() * this.validIndexes.length));
      var i = Math.floor(this.validIndexes[randomIndex] / 3);
      var j = this.validIndexes[randomIndex] % 3;


      // Make the move
      this.table.rows[i].cells[j].innerHTML = "O"

      // Mark that position as inaccessible
      this.validIndexes.splice( randomIndex, 1 );
  }

  printGameBoard() {
    for(var i = 0; i < 3; i++) {
        for(var j = 0; j < 3; j++)
          console.log(this.table.rows[i].cells[j].innerHTML);
    }
  }
}

var table = document.getElementById('gameTable');
let gameObj = new Game(table)

$(document).ready(function(){
  $("#gameTable td").click(function() {

      var column_num = parseInt( $(this).index() );
      var row_num = parseInt( $(this).parent().index() );

      //alert("Row: " + row_num + ", Col: " + column_num)
      gameObj.movePlayer( row_num, column_num )
  });
});


gameObj.printGameBoard();
</script>
</html>
